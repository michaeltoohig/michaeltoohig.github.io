<!DOCTYPE html><html class=2xl:text-[20px] dir=ltr lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Offline-First PWA — Michael Toohig</title><meta content="A webapp built for offline users which gracefully handles expired authorizations." name=description><meta content=index,follow name=robots><link href=https://michaeltoohig.com/blog/offline-first-pwa rel=canonical><meta content="Offline-First PWA" property=og:title><meta content="A webapp built for offline users which gracefully handles expired authorizations." property=og:description><meta content=https://michaeltoohig.com/blog/offline-first-pwa property=og:url><meta content=article property=og:type><meta content=https://michaeltoohig.com/_astro/offline-first-pwa.Csr9j16h.jpg property=og:image><meta content="Offline-First PWA" property=og:image:alt><meta content=summary_large_image name=twitter:card><style is:global>:root{--aw-font-sans:'InterVariable';--aw-font-serif:var(--aw-font-sans);--aw-font-heading:var(--aw-font-sans);--aw-color-primary:#E37D3A;--aw-color-secondary:rgb(30 58 138);--aw-color-accent:rgb(109 40 217);--aw-color-text-page:rgb(17 24 39);--aw-color-text-muted:rgb(75 85 99);--aw-color-bg-page:rgb(255 255 255)}</style><meta content=orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M name=google-site-verification><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/sitemap-index.xml rel=sitemap><link href=/_astro/about.DalL60B6.css rel=stylesheet><style>.link-preview[data-astro-cid-ztfdmrby]{--lp-width:var(--link-preview-width, 30em);--lp-pad-x:var(--link-preview-padding-inline, 0);--lp-pad-y:var(--link-preview-padding-block, .5em);--lp-corners:var(--link-preview-corners, 0);--lp-desc-lines:var(--link-preview-description-lines, 1);position:relative;width:var(--lp-width);max-width:100%;display:flex;flex-direction:column-reverse;border-radius:var(--lp-corners)}.link-preview[data-astro-cid-ztfdmrby] [data-astro-cid-ztfdmrby]{margin:0!important}.link-preview__content[data-astro-cid-ztfdmrby]{display:flex;flex-direction:column;padding:var(--lp-pad-y) var(--lp-pad-x)}.link-preview[data-astro-cid-ztfdmrby] header[data-astro-cid-ztfdmrby]{display:flex;flex-direction:column-reverse}.link-preview__description[data-astro-cid-ztfdmrby]{display:-webkit-box;-webkit-line-clamp:var(--lp-desc-lines);-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.link-preview[data-astro-cid-ztfdmrby]:not(.link-preview--has-video) a[data-astro-cid-ztfdmrby]:after{content:"";position:absolute;inset:0}.link-preview[data-astro-cid-ztfdmrby] img[data-astro-cid-ztfdmrby],.link-preview[data-astro-cid-ztfdmrby] video[data-astro-cid-ztfdmrby]{aspect-ratio:1200/630;width:100%;height:auto;-o-object-fit:cover;object-fit:cover;border-top-left-radius:var(--lp-corners);border-top-right-radius:var(--lp-corners)}</style><style>.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding,1em);border:1px solid var(--tc-border-color,#cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}.twitter-tweet.twitter-tweet-rendered{color-scheme:normal}</style><style>lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:0 0;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color,#00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:after,lite-vimeo>.ltv-playbtn:before{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}</style><style>lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}</style><style>lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube .lty-playbtn:focus,lite-youtube:hover>.lty-playbtn{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}</style><script src=/_astro/Vimeo.astro_astro_type_script_index_0_lang.CgRsrQuG.js type=module></script><script src=/_astro/YouTube.astro_astro_type_script_index_0_lang.Dkyb9mLy.js type=module></script></head><body class="dark:bg-dark antialiased bg-light dark:text-slate-300 text-page tracking-tight"><div class=block></div><header class="mx-auto w-full duration-100 ease-in flex-none relative top-0 transition-all z-40" id=header><div class="mx-auto max-w-7xl md:flex md:justify-between md:px-4 md:py-3.5 px-3 py-3 w-full"><div class="flex justify-between"><a href=/ class="items-center flex"><span class="font-bold dark:text-white md:text-xl ml-2 self-center text-2xl text-gray-900 whitespace-nowrap">Michael Toohig</span></a><div class="items-center flex md:hidden"><button class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label="Toggle between Dark and Light mode" type=button data-aw-toggle-color-scheme><svg class="h-6 w-6" data-icon=ph:sun height=1em width=1em><symbol id=ai:ph:sun viewBox="0 0 256 256"><path d="M120 40V16a8 8 0 0 1 16 0v24a8 8 0 0 1-16 0m72 88a64 64 0 1 1-64-64a64.07 64.07 0 0 1 64 64m-16 0a48 48 0 1 0-48 48a48.05 48.05 0 0 0 48-48M58.34 69.66a8 8 0 0 0 11.32-11.32l-16-16a8 8 0 0 0-11.32 11.32Zm0 116.68l-16 16a8 8 0 0 0 11.32 11.32l16-16a8 8 0 0 0-11.32-11.32M192 72a8 8 0 0 0 5.66-2.34l16-16a8 8 0 0 0-11.32-11.32l-16 16A8 8 0 0 0 192 72m5.66 114.34a8 8 0 0 0-11.32 11.32l16 16a8 8 0 0 0 11.32-11.32ZM48 128a8 8 0 0 0-8-8H16a8 8 0 0 0 0 16h24a8 8 0 0 0 8-8m80 80a8 8 0 0 0-8 8v24a8 8 0 0 0 16 0v-24a8 8 0 0 0-8-8m112-88h-24a8 8 0 0 0 0 16h24a8 8 0 0 0 0-16" fill=currentColor /></symbol><use href=#ai:ph:sun></use></svg></button> <button class="items-center transition dark:focus:ring-gray-700 dark:hover:bg-gray-800 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex ml-1.5 p-2.5 rounded-lg text-gray-500 text-sm" aria-label="Toggle Menu" type=button data-aw-toggle-menu><svg class="h-6 w-6" data-icon=ph:dots-three-vertical height=1em width=1em><symbol id=ai:ph:dots-three-vertical viewBox="0 0 256 256"><path d="M140 128a12 12 0 1 1-12-12a12 12 0 0 1 12 12m-12-56a12 12 0 1 0-12-12a12 12 0 0 0 12 12m0 112a12 12 0 1 0 12 12a12 12 0 0 0-12-12" fill=currentColor /></symbol><use href=#ai:ph:dots-three-vertical></use></svg></button></div></div><nav aria-label="Main navigation" class="items-center hidden md:flex dark:text-slate-200 h-[calc(100vh-72px)] md:h-auto md:mx-5 md:overflow-visible md:w-auto overflow-y-auto w-full"><ul class="flex flex-col md:flex-row md:pt-0 md:self-center md:text-base md:w-auto pt-8 text-xl w-full"><li class=""><a href=/about class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">About</a></li><li class=""><a href=/projects class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Projects</a></li><li class=""><a href=/blog class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Blog</a></li><li class=""><a href=/blurbs class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Blurbs</a></li><li class=""><a href=/links class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Links</a></li></ul></nav><div class="items-center flex md:mb-0 md:self-center"><div class="items-center hidden md:flex"><button class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label="Toggle between Dark and Light mode" type=button data-aw-toggle-color-scheme><svg class="h-5 w-5" data-icon=ph:sun height=1em width=1em viewBox="0 0 256 256"><use href=#ai:ph:sun></use></svg></button></div></div></div></header><main><section class="mx-auto lg:py-20 py-8 sm:py-16"><article><header class=""><div class="flex px-4 flex-col justify-between max-w-3xl mb-2 mt-0 mx-auto sm:flex-row sm:items-center sm:px-6"><p><svg class="dark:text-gray-400 -mt-0.5 h-4 inline-block w-4" data-icon=ph:timer height=1em width=1em><symbol id=ai:ph:timer viewBox="0 0 256 256"><path d="M128 40a96 96 0 1 0 96 96a96.11 96.11 0 0 0-96-96m0 176a80 80 0 1 1 80-80a80.09 80.09 0 0 1-80 80m45.66-125.66a8 8 0 0 1 0 11.32l-40 40a8 8 0 0 1-11.32-11.32l40-40a8 8 0 0 1 11.32 0M96 16a8 8 0 0 1 8-8h48a8 8 0 0 1 0 16h-48a8 8 0 0 1-8-8" fill=currentColor /></symbol><use href=#ai:ph:timer></use></svg> <time datetime="Sat Apr 06 2024 20:00:00 GMT-0400 (Eastern Daylight Time)">Apr 7, 2024</time> · 6 min read</p></div><h1 class="mx-auto sm:px-6 max-w-3xl px-4 font-bold font-heading leading-tighter md:text-5xl text-4xl tracking-tighter">Offline-First PWA</h1><p class="mx-auto sm:px-6 max-w-3xl px-4 dark:text-slate-400 mb-8 md:text-2xl mt-4 text-justify text-muted text-xl"></p><img alt="A webapp built for offline users which gracefully handles expired authorizations." aspectRatio=1.7777777777777777 class="mx-auto bg-gray-400 dark:bg-slate-700 dark:lg:shadow-orange-200 lg:max-w-6xl lg:ring-2 lg:shadow-lg max-w-full mb-6 ring-none ring-opacity-50 ring-orange-500 sm:rounded-md" decoding=async height=506 loading=eager sizes="(max-width: 900px) 400px, 900px" src=/_astro/offline-first-pwa.Csr9j16h_ZchCS.webp srcset="/_astro/offline-first-pwa.Csr9j16h_ZchCS.webp 400w, /_astro/offline-first-pwa.Csr9j16h_ZchCS.webp 900w" width=900></header><div class="mx-auto sm:px-6 max-w-3xl px-6 mt-8 dark:prose-a:text-orange-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-orange-600 prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-lg prose-li:my-0 prose-md prose-table:max-w-10 prose-table:overflow-x-scroll prose-table:table-auto"><p>I needed an app that would allow users to submit forms while offline and/or with expired authorization credentials. But the app is not available for anyone to access so the user must be manually registered and the user must first login while online once before using the app. Similar to a <em>guest mode</em> on e-commerce or other websites but the app is not open for the public and the app is expected to work without network or authorization to the backend; hence it works offline first.</p><p>The users for this app are delivery drivers who operate in remote areas for extended trips so a worst case scenario is losing authorization, going offline then stuck at the login screen unable to use the app to record deliveries.</p><h2 id=solution>Solution</h2><p>The solution revolves around my <code>authStore</code> and the decision I made to treat both the user’s info and their authorization as independent entities. In a typical app with user login the two would be all or nothing and when the authorization token is lost the user is usually logged out and forced to login again to verify their identity. I decided if the user had logged in once already then I can allow them to continue in the app and they can fill an outbox with items but can not submit the items until they verify their identity again by logging in. Plus, this outbox pulls double-duty for authenticated users who just happen to be offline.</p><h3 id=handling-authorization>Handling Authorization</h3><p>First step, I had to keep info about the user and the user’s authorization token in the browser’s local storage.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=ts data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">authStore.ts</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>export</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> storedUser</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> Ref</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>string</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> |</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useStorage</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>export</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authToken</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> Ref</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>string</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> |</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useStorage</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>auth_token</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span></code></pre></figure><p>Then I set up an <code>auth</code> store with Pinia and defined basic actions. I’m using Directus for the backend of this project. Of note, <code>user</code> is a computed value using the <code>storedUser</code> so that even after a page refresh we can seamlessly load the user from the browser’s storage.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=ts data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">authStore.ts</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>export</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> useAuthStore </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> defineStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>auth</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>  state</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> ()</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> AuthStoreState</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =&gt;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> ({</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    loading</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> false</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    error</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  }),</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  getters</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>    user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> UserType</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> |</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>!</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> return</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      try</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>?</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> JSON</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>parse</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> as</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> UserType</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> :</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> catch</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        console</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>log</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>[Auth] failed to parse user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        return</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    },</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>    isLoggedIn</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> boolean</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authToken</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>!==</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> &amp;&amp;</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>user </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>!==</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    },</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  },</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  actions</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    async</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> getMe</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      try</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> directus</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>users</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>read</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> user</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> UserType</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          first_name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>first_name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          last_name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>last_name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          email</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>email</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          avatar</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>avatar</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>        };</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> JSON</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>stringify</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> catch</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        console</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>log</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>[Auth] error fetching me</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        throw</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    },</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    async</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>credentials</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> CredentialsType</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      try</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>        this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>loading </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> true</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> directus</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>auth</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>({</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> ...</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>credentials </span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>});</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        await</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>getMe</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        return</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> catch</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>err</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>:</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> any</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> error </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>response</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>?.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>data</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>?.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>errors</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>[</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>0</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>]?.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>extensions</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>?.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>code </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>||</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>error </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>==</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>INVALID_CREDENTIALS</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> ||</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> error </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>==</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>Error: Invalid user credentials.</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>          this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>error </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>INVALID_CREDENTIALS</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>        }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> else</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>          console</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>error</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>[Auth] Unhandled login error</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>          this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>error </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>        }</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        throw</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> finally</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>        this</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>loading </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> false</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    },</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    async</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> logout</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      try</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> directus</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>auth</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>logout</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> finally</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        authToken</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> null</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    },</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  },</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>});</span></span></code></pre></figure><h3 id=login-page>Login Page</h3><p>The app’s router can now use the <code>authStore</code> and only if there is no <code>user</code> do we direct the user to the login page. This allows a user that has previously logged in to continue using the app without an auth token. This would now be an <em>anonymous</em> mode or something but not a <em>guest</em> mode like you would see on some e-commerce websites.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=ts data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">router.ts</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>router</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>beforeEach</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>((</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>to</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> from</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> next</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =&gt;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>  if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>to</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>name </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>===</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authStore </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useAuthStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>authStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>isLoggedIn</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>      next</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>({</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>home</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> });</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  }</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>  if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>to</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>matched</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>some</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>((</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>record</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =&gt;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> record</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>meta</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>requiresAuth</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>))</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authStore </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useAuthStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>!</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>authStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>      next</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>({</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> });</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  }</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>  next</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>});</span></span></code></pre></figure><blockquote><p>Later, have to handle some problems we just introduced if an unauthenticated user attempts to GET something from a protected endpoint.</p></blockquote><p>A user may try to login but then become offline, so to prevent being stuck on the login screen we add a link to allow the user to return to the main app. Alternatively, we could have offered a modal for users to re-login which would not lock the user in a route they cannot navigate out of otherwise. Or someone could not design their login page like mine which hid all navigation by default <span aria-hidden=true aria-label="" role=img>🤷</span>.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=vue data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">LoginPage.vue</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=vue data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=vue data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>template</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;!-- page layout and form omitted --&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>router-link</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> v-if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> :</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>to</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>{</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>home</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> }</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  Skip</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>router-link</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>template</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>script</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> setup lang</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>ts</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authStore </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useAuthStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>const</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> user </span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>}</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> storeToRefs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>authStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>script</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span></code></pre></figure><p>Elsewhere we can write logic to distinguish between a user with valid authorization or not using <code>isLoggedIn</code>.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=vue data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">Foo.vue</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=vue data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=vue data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>template</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  &lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>button</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> v-if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>isLoggedIn</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> @</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>click</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>syncPendingRequests</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>Send Outbox Items</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>button</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  &lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>router-link</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> v-else</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> :</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>to</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>{</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> name</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> }</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>Login</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>router-link</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>template</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>script</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> setup lang</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>ts</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authStore </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> useAuthStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>const</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> isLoggedIn </span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>}</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> storeToRefs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>authStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&lt;/</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>script</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&gt;</span></span></code></pre></figure><h3 id=handling-authorization-errors-while-offline>Handling Authorization Errors While Offline</h3><p>This may be enough boilerplate for some offline apps; however, for this particular app I needed more as all API endpoints including GET endpoints were secured. Therefore, without authorization the app would not be able to fetch what it needs to function. Here the service worker again transparently does double service to provide a cache for us when the user is offline or when the user is currently unauthorized.</p><p>I was leaning on Workbox for this app’s service worker and to make it respond with cached results due to authorization errors I had to add a small plugin to the caching strategy.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=ts data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">service-worker.ts</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>registerRoute</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  matchDirectusApiCb</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>  new</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> StaleWhileRevalidate</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>({</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    cacheName</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>api</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    plugins</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> [</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      new</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> CacheableResponsePlugin</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>({</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>        statuses</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> [</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>0</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 200</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>],</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      }),</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      {</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>        cacheWillUpdate</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> async</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> ({</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> request</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> response </span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>})</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =&gt;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>          if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>response </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>&amp;&amp;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> response</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>status </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>===</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 403</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>            const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> cache </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> caches</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>open</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>api</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>            const</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> cachedResponse </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> cache</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>match</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>request</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>            if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>cachedResponse</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>              return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> cachedResponse</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>            }</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>          }</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>          return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> response</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>;</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>        },</span></span>
<span data-line="" data-highlighted-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      },</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    ],</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  })</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span></code></pre></figure><h3 id=entry-point-to-offline-first>Entry Point to Offline-First</h3><p>Finally, we modify <code>App.vue</code> to attempt to update the current <code>storedUser</code> on initial load of the app. If that fails due to an expired or missing auth token then the app will continue forward using the last known user from the browser’s storage and if that fails then we hit the login page per the router’s setup. And that’s it, the user can now use the app in an offline-first manner.</p><figure data-rehype-pretty-code-figure=""><figcaption data-language=ts data-rehype-pretty-code-title="" data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)">App.vue</figcaption><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=ts data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>onBeforeMount</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>async</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> ()</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> =&gt;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  console</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>info</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>[App] Checking auth onBeforeMount</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>  if</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>storedUser</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>value</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    // previous login exists</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    try</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>      // update user</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>      await</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> authStore</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>getMe</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>();</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    }</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> catch</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> {</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>      console</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>log</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>[App] failed to get user</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&#39;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> err</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>);</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>  }</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>});</span></span></code></pre></figure><h2 id=next-steps>Next Steps</h2><p>Now, this particular setup works for my usecase but it is not a panacea for all offline-first apps.</p><p>Firstly, I have the benefit of an app with closed registration which reduces the number of edge cases. Otherwise, I may have to consider handling deleting the current outbox when the user voluntarily logs out of the app as a new user could inherit an existing outbox when they login to a shared device.</p><p>Secondly, this design relies on a service worker but an alternative solution could implement a local cache.</p><p>For a different app you may have to adapt this tutorial for your particular requirements.</p><h2 id=conclusion>Conclusion</h2><p>I hope this tutorial helps others to develop more apps that do not depend on an ever-present internet access. Also, I am grateful for being afforded the time to develop this app which actually provides real-world benefit.</p></div><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mt-8 px-6"><ul class=mr-5><li class="dark:bg-slate-700 bg-gray-100 font-medium inline-block lowercase mb-2 mr-2 px-2 py-0.5">pwa</li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="font-bold align-super dark:text-slate-400 text-gray-400">Share:</span> <button class=ml-2 data-aw-social-share=twitter data-aw-url=https://michaeltoohig.com/blog/offline-first-pwa title="Twitter Share" data-aw-text="Offline-First PWA"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:twitter-fill height=1em width=1em><symbol id=ai:ri:twitter-fill viewBox="0 0 24 24"><path d="M22.213 5.656a8.4 8.4 0 0 1-2.402.658A4.2 4.2 0 0 0 21.649 4c-.82.488-1.719.83-2.655 1.015a4.182 4.182 0 0 0-7.126 3.814a11.87 11.87 0 0 1-8.621-4.37a4.17 4.17 0 0 0-.566 2.103c0 1.45.739 2.731 1.86 3.481a4.2 4.2 0 0 1-1.894-.523v.051a4.185 4.185 0 0 0 3.355 4.102a4.2 4.2 0 0 1-1.89.072A4.185 4.185 0 0 0 8.02 16.65a8.4 8.4 0 0 1-6.192 1.732a11.83 11.83 0 0 0 6.41 1.88c7.694 0 11.9-6.373 11.9-11.9q0-.271-.012-.541a8.5 8.5 0 0 0 2.086-2.164" fill=currentColor /></symbol><use href=#ai:ri:twitter-fill></use></svg></button> <button class=ml-2 data-aw-social-share=facebook data-aw-url=https://michaeltoohig.com/blog/offline-first-pwa title="Facebook Share"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:facebook-box-fill height=1em width=1em><symbol id=ai:ri:facebook-box-fill viewBox="0 0 24 24"><path d="M15.402 21v-6.966h2.333l.349-2.708h-2.682V9.599c0-.784.218-1.319 1.342-1.319h1.434V5.857a19 19 0 0 0-2.09-.107c-2.067 0-3.482 1.262-3.482 3.58v1.996h-2.338v2.708h2.338V21H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1z" fill=currentColor /></symbol><use href=#ai:ri:facebook-box-fill></use></svg></button> <button class=ml-2 data-aw-social-share=linkedin data-aw-url=https://michaeltoohig.com/blog/offline-first-pwa title="Linkedin Share" data-aw-text="Offline-First PWA"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:linkedin-box-fill height=1em width=1em><symbol id=ai:ri:linkedin-box-fill viewBox="0 0 24 24"><path d="M18.336 18.339h-2.665v-4.177c0-.996-.02-2.278-1.39-2.278c-1.389 0-1.601 1.084-1.601 2.205v4.25h-2.666V9.75h2.56v1.17h.035c.358-.674 1.228-1.387 2.528-1.387c2.7 0 3.2 1.778 3.2 4.092v4.714M7.004 8.575a1.546 1.546 0 0 1-1.548-1.549a1.548 1.548 0 1 1 1.547 1.549m1.336 9.764H5.667V9.75H8.34zM19.67 3H4.33C3.594 3 3 3.58 3 4.297v15.406C3 20.42 3.594 21 4.328 21h15.339C20.4 21 21 20.42 21 19.703V4.297C21 3.581 20.4 3 19.666 3z" fill=currentColor /></symbol><use href=#ai:ri:linkedin-box-fill></use></svg></button> <button class=ml-2 data-aw-social-share=whatsapp data-aw-url=https://michaeltoohig.com/blog/offline-first-pwa title="Whatsapp Share" data-aw-text="Offline-First PWA"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:whatsapp-fill height=1em width=1em><symbol id=ai:ri:whatsapp-fill viewBox="0 0 24 24"><path d="M12.001 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.95 9.95 0 0 1-5.03-1.355L2.005 22l1.352-4.968A9.95 9.95 0 0 1 2.001 12c0-5.523 4.477-10 10-10M8.593 7.3l-.2.008a1 1 0 0 0-.372.1a1.3 1.3 0 0 0-.294.228c-.12.113-.188.211-.261.306A2.73 2.73 0 0 0 6.9 9.62c.002.49.13.967.33 1.413c.409.902 1.082 1.857 1.97 2.742c.214.213.424.427.65.626a9.45 9.45 0 0 0 3.84 2.046l.568.087c.185.01.37-.004.556-.013a2 2 0 0 0 .833-.231a5 5 0 0 0 .383-.22q.001.002.125-.09c.135-.1.218-.171.33-.288q.126-.13.21-.302c.078-.163.156-.474.188-.733c.024-.198.017-.306.014-.373c-.004-.107-.093-.218-.19-.265l-.582-.261s-.87-.379-1.402-.621a.5.5 0 0 0-.176-.041a.48.48 0 0 0-.378.127c-.005-.002-.072.055-.795.931a.35.35 0 0 1-.368.13a1.4 1.4 0 0 1-.191-.066c-.124-.052-.167-.072-.252-.108a6 6 0 0 1-1.575-1.003c-.126-.11-.243-.23-.363-.346a6.3 6.3 0 0 1-1.02-1.268l-.059-.095a1 1 0 0 1-.102-.205c-.038-.147.061-.265.061-.265s.243-.266.356-.41c.11-.14.203-.276.263-.373c.118-.19.155-.385.093-.536q-.42-1.026-.868-2.041c-.059-.134-.234-.23-.393-.249q-.081-.01-.162-.016a3 3 0 0 0-.403.004z" fill=currentColor /></symbol><use href=#ai:ri:whatsapp-fill></use></svg></button> <button class=ml-2 data-aw-social-share=mail data-aw-url=https://michaeltoohig.com/blog/offline-first-pwa title="Email Share" data-aw-text="Offline-First PWA"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:mail-fill height=1em width=1em><symbol id=ai:ri:mail-fill viewBox="0 0 24 24"><path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m9.06 8.683L5.648 6.238L4.353 7.762l7.72 6.555l7.581-6.56l-1.308-1.513z" fill=currentColor /></symbol><use href=#ai:ri:mail-fill></use></svg></button></div></div></article></section><div class="mx-auto sm:px-6 max-w-3xl px-6 md:pb-20 md:pt-4 pb-12 pt-8"><a href=/blog class="btn btn-ghost md:px-3 px-3"><svg class="h-5 w-5 -ml-1.5 mr-1" data-icon=ph:arrow-fat-left height=1em width=1em><symbol id=ai:ph:arrow-fat-left viewBox="0 0 256 256"><path d="M208 72h-80V32a8 8 0 0 0-13.66-5.66l-96 96a8 8 0 0 0 0 11.32l96 96A8 8 0 0 0 128 224v-40h80a16 16 0 0 0 16-16V88a16 16 0 0 0-16-16m0 96h-88a8 8 0 0 0-8 8v28.69L35.31 128L112 51.31V80a8 8 0 0 0 8 8h88Z" fill=currentColor /></symbol><use href=#ai:ph:arrow-fat-left></use></svg> Back to Blog</a></div><section class="bg-opacity-50 bg-orange-200 dark:bg-slate-800 lg:mb-20 max-w-3xl mb-16 md:mx-auto mx-4 pb-2 rounded-sm"><div class="mx-auto sm:px-6 font-medium px-2 py-4 text-left text-lg"><span class="font-bold text-primary"><svg class="h-5 w-5 align-text-bottom inline-block" data-icon=ph:info height=1em width=1em><symbol id=ai:ph:info viewBox="0 0 256 256"><path d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m16-40a8 8 0 0 1-8 8a16 16 0 0 1-16-16v-40a8 8 0 0 1 0-16a16 16 0 0 1 16 16v40a8 8 0 0 1 8 8m-32-92a12 12 0 1 1 12 12a12 12 0 0 1-12-12" fill=currentColor /></symbol><use href=#ai:ph:info></use></svg> FYI: </span>This post is a part of the following project.</div><div class="px-2 sm:px-6"><article class="mb-6 transition"><div class="dark:bg-slate-700 bg-gray-400 mb-6 md:h-88 relative rounded shadow-lg"><a href=/projects/ssc-drivers><img alt="South Sea Cargo Driver's App" aspectRatio=16:9 class="w-full md:w-auto bg-gray-400 dark:bg-slate-700 md:h-full md:object-cover rounded shadow-lg" decoding=async height=224 loading=lazy sizes="(max-width: 900px) 400px, 900px" src=/_astro/cover.BiItD24z_9rTuw.webp srcset="/_astro/cover.BiItD24z_9rTuw.webp 400w, /_astro/cover.BiItD24z_9rTuw.webp 900w" width=400></a></div><h3 class="font-bold font-heading leading-tight mb-2 sm:text-2xl text-xl"><a href=/projects/ssc-drivers class="dark:hover:text-primary duration-200 ease-in hover:text-primary transition">South Sea Cargo Driver&#39;s App</a></h3><p class="dark:text-slate-400 text-muted text-lg">Offline-First PWA for delivery drivers in remote areas</p></article></div></section></main><footer class="border-gray-200 border-t dark:border-slate-800 relative"><div class="dark:bg-dark absolute inset-0 pointer-events-none" aria-hidden=true></div><div class="mx-auto sm:px-6 px-4 dark:text-slate-300 max-w-7xl relative"><div class="py-8 gap-4 gap-y-8 grid grid-cols-12 md:py-12 sm:gap-8"><div class="col-span-12 lg:col-span-4"><div class=mb-2><a href=/ class="font-bold text-xl inline-block">Michael Toohig</a></div></div></div><div class="md:items-center md:flex md:justify-between md:py-8 py-6"><ul class="flex md:mb-0 -ml-2 mb-4 md:ml-4 md:order-1"><li><a href=/rss.xml class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label=RSS><svg class="h-5 w-5" data-icon=ph:rss height=1em width=1em><symbol id=ai:ph:rss viewBox="0 0 256 256"><path d="M106.91 149.09A71.53 71.53 0 0 1 128 200a8 8 0 0 1-16 0a56 56 0 0 0-56-56a8 8 0 0 1 0-16a71.53 71.53 0 0 1 50.91 21.09M56 80a8 8 0 0 0 0 16a104 104 0 0 1 104 104a8 8 0 0 0 16 0A120 120 0 0 0 56 80m118.79 1.21A166.9 166.9 0 0 0 56 32a8 8 0 0 0 0 16a151 151 0 0 1 107.48 44.52A151 151 0 0 1 208 200a8 8 0 0 0 16 0a166.9 166.9 0 0 0-49.21-118.79M60 184a12 12 0 1 0 12 12a12 12 0 0 0-12-12" fill=currentColor /></symbol><use href=#ai:ph:rss></use></svg></a></li><li><a href=https://github.com/michaeltoohig class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label=Github><svg class="h-5 w-5" data-icon=ph:github-logo height=1em width=1em><symbol id=ai:ph:github-logo viewBox="0 0 256 256"><path d="M208.31 75.68A59.78 59.78 0 0 0 202.93 28a8 8 0 0 0-6.93-4a59.75 59.75 0 0 0-48 24h-24a59.75 59.75 0 0 0-48-24a8 8 0 0 0-6.93 4a59.78 59.78 0 0 0-5.38 47.68A58.14 58.14 0 0 0 56 104v8a56.06 56.06 0 0 0 48.44 55.47A39.8 39.8 0 0 0 96 192v8H72a24 24 0 0 1-24-24a40 40 0 0 0-40-40a8 8 0 0 0 0 16a24 24 0 0 1 24 24a40 40 0 0 0 40 40h24v16a8 8 0 0 0 16 0v-40a24 24 0 0 1 48 0v40a8 8 0 0 0 16 0v-40a39.8 39.8 0 0 0-8.44-24.53A56.06 56.06 0 0 0 216 112v-8a58.14 58.14 0 0 0-7.69-28.32M200 112a40 40 0 0 1-40 40h-48a40 40 0 0 1-40-40v-8a41.74 41.74 0 0 1 6.9-22.48a8 8 0 0 0 1.1-7.69a43.8 43.8 0 0 1 .79-33.58a43.88 43.88 0 0 1 32.32 20.06a8 8 0 0 0 6.71 3.69h32.35a8 8 0 0 0 6.74-3.69a43.87 43.87 0 0 1 32.32-20.06a43.8 43.8 0 0 1 .77 33.58a8.09 8.09 0 0 0 1 7.65a41.7 41.7 0 0 1 7 22.52Z" fill=currentColor /></symbol><use href=#ai:ph:github-logo></use></svg></a></li></ul><div class="dark:text-slate-400 mr-4 text-sm">Made in Vanuatu 🇻🇺 · All rights reserved.</div></div></div></footer><script>!function(){const e="system";function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function o(e,t,o){const n="string"==typeof e?document.querySelectorAll(e):e;n&&n.length&&n.forEach((e=>{e.addEventListener(t,(t=>o(t,e)),!1)}))}e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light"),window.onload=function(){let t=window.scrollY,n=!0;function a(){const e=document.getElementById("header");t>60&&!e.classList.contains("scroll")?document.getElementById("header").classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&document.getElementById("header").classList.remove("scroll"),n=!1}o("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.querySelector("#header nav")?.classList.toggle("hidden")})),o("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),o("[data-aw-social-share]","click",(function(e,t){const o=t.getAttribute("data-aw-social-share"),n=encodeURIComponent(t.getAttribute("data-aw-url")),a=encodeURIComponent(t.getAttribute("data-aw-text"));let c;switch(o){case"facebook":c=`https://www.facebook.com/sharer.php?u=${n}`;break;case"twitter":c=`https://twitter.com/intent/tweet?url=${n}&text=${a}`;break;case"linkedin":c=`https://www.linkedin.com/shareArticle?mini=true&url=${n}&title=${a}`;break;case"whatsapp":c=`https://wa.me/?text=${a}%20${n}`;break;case"mail":c=`mailto:?subject=%22${a}%22&body=${a}%20${n}`;break;default:return}const s=document.createElement("a");s.target="_blank",s.href=c,s.click()})),a(),o([document],"scroll",(function(){t=window.scrollY,n||(window.requestAnimationFrame((()=>{a()})),n=!0)}))},window.onpageshow=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.querySelector("#header nav")?.classList.add("hidden")}}()</script></body></html>