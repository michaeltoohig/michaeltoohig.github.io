<!DOCTYPE html><html class=2xl:text-[20px] dir=ltr lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Integrating A New Subscriber Management System — Michael Toohig</title><meta content="Writing the glue to tie two different systems under one managment software.
" name=description><meta content=index,follow name=robots><link href=https://michaeltoohig.com/projects/integrating-a-new-sms rel=canonical><meta content="Integrating A New Subscriber Management System" property=og:title><meta content="Writing the glue to tie two different systems under one managment software.
" property=og:description><meta content=https://michaeltoohig.com/projects/integrating-a-new-sms property=og:url><meta content=article property=og:type><meta content=https://michaeltoohig.com/_astro/integrating-a-new-sms.C1b65GVB.jpg property=og:image><meta content="Integrating A New Subscriber Management System" property=og:image:alt><meta content=summary_large_image name=twitter:card><style is:global>:root{--aw-font-sans:'InterVariable';--aw-font-serif:var(--aw-font-sans);--aw-font-heading:var(--aw-font-sans);--aw-color-primary:#E37D3A;--aw-color-secondary:rgb(30 58 138);--aw-color-accent:rgb(109 40 217);--aw-color-text-page:rgb(17 24 39);--aw-color-text-muted:rgb(75 85 99);--aw-color-bg-page:rgb(255 255 255)}</style><meta content=orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M name=google-site-verification><link href=/icons/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/icons/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/icons/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/sitemap-index.xml rel=sitemap><link href=/_astro/about.DalL60B6.css rel=stylesheet><style>.link-preview[data-astro-cid-ztfdmrby]{--lp-width:var(--link-preview-width, 30em);--lp-pad-x:var(--link-preview-padding-inline, 0);--lp-pad-y:var(--link-preview-padding-block, .5em);--lp-corners:var(--link-preview-corners, 0);--lp-desc-lines:var(--link-preview-description-lines, 1);position:relative;width:var(--lp-width);max-width:100%;display:flex;flex-direction:column-reverse;border-radius:var(--lp-corners)}.link-preview[data-astro-cid-ztfdmrby] [data-astro-cid-ztfdmrby]{margin:0!important}.link-preview__content[data-astro-cid-ztfdmrby]{display:flex;flex-direction:column;padding:var(--lp-pad-y) var(--lp-pad-x)}.link-preview[data-astro-cid-ztfdmrby] header[data-astro-cid-ztfdmrby]{display:flex;flex-direction:column-reverse}.link-preview__description[data-astro-cid-ztfdmrby]{display:-webkit-box;-webkit-line-clamp:var(--lp-desc-lines);-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.link-preview[data-astro-cid-ztfdmrby]:not(.link-preview--has-video) a[data-astro-cid-ztfdmrby]:after{content:"";position:absolute;inset:0}.link-preview[data-astro-cid-ztfdmrby] img[data-astro-cid-ztfdmrby],.link-preview[data-astro-cid-ztfdmrby] video[data-astro-cid-ztfdmrby]{aspect-ratio:1200/630;width:100%;height:auto;-o-object-fit:cover;object-fit:cover;border-top-left-radius:var(--lp-corners);border-top-right-radius:var(--lp-corners)}</style><style>.twitter-tweet:not(.twitter-tweet-rendered){padding:var(--tc-padding,1em);border:1px solid var(--tc-border-color,#cfd9de)}.twitter-tweet:not(.twitter-tweet-rendered)>:first-child{margin-top:0}.twitter-tweet:not(.twitter-tweet-rendered)>:last-child{margin-bottom:0}.twitter-tweet.twitter-tweet-rendered{color-scheme:normal}</style><style>lite-vimeo{font-size:10px;background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover}lite-vimeo:after{content:"";display:block;padding-bottom:56.25%}lite-vimeo>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}lite-vimeo>.ltv-playbtn{content:"";position:absolute;inset:0;width:100%;background:0 0;outline:0;border:0;cursor:pointer}lite-vimeo>.ltv-playbtn:before{width:6.5em;height:4em;background:#172322bf;opacity:.8;border-radius:.25rem;transition:all .2s cubic-bezier(0,0,.2,1)}lite-vimeo>.ltv-playbtn:focus:before{outline:auto}lite-vimeo:hover>.ltv-playbtn:before{background-color:#00adef;background-color:var(--ltv-color,#00adef);opacity:1}lite-vimeo>.ltv-playbtn:after{border-style:solid;border-width:1em 0 1em 1.7em;border-color:transparent transparent transparent #fff}lite-vimeo>.ltv-playbtn:after,lite-vimeo>.ltv-playbtn:before{content:"";position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}lite-vimeo.ltv-activated:before,lite-vimeo.ltv-activated>.ltv-playbtn{cursor:unset;opacity:0;pointer-events:none}</style><style>lite-youtube>iframe{all:unset!important;width:100%!important;height:100%!important;position:absolute!important;inset:0!important;border:0!important}</style><style>lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:720px}lite-youtube:before{content:attr(data-title);display:block;position:absolute;top:0;background-image:linear-gradient(180deg,#000000ab,#0000008a 14%,#00000026 54%,#0000000d 72%,#0000 94%);height:99px;width:100%;font-family:YouTube Noto,Roboto,Arial,Helvetica,sans-serif;color:#eee;text-shadow:0 0 2px rgba(0,0,0,.5);font-size:18px;padding:25px 20px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}lite-youtube:hover:before{color:#fff}lite-youtube:after{content:"";display:block;padding-bottom:56.25%}lite-youtube>iframe{width:100%;height:100%;position:absolute;top:0;left:0;border:0}lite-youtube>.lty-playbtn{display:block;width:100%;height:100%;background:no-repeat center/68px 48px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 68 48"><path d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z" fill="red"/><path d="M45 24 27 14v20" fill="white"/></svg>');position:absolute;cursor:pointer;z-index:1;filter:grayscale(100%);transition:filter .1s cubic-bezier(0,0,.2,1);border:0}lite-youtube .lty-playbtn:focus,lite-youtube:hover>.lty-playbtn{filter:none}lite-youtube.lyt-activated{cursor:unset}lite-youtube.lyt-activated:before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}.lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}</style><script src=/_astro/Vimeo.astro_astro_type_script_index_0_lang.CgRsrQuG.js type=module></script><script src=/_astro/YouTube.astro_astro_type_script_index_0_lang.Dkyb9mLy.js type=module></script></head><body class="dark:bg-dark antialiased bg-light dark:text-slate-300 text-page tracking-tight"><div class=block></div><header class="mx-auto w-full duration-100 ease-in flex-none relative top-0 transition-all z-40" id=header><div class="mx-auto max-w-7xl md:flex md:justify-between md:px-4 md:py-3.5 px-3 py-3 w-full"><div class="flex justify-between"><a href=/ class="items-center flex"><span class="ml-2 dark:text-white font-bold md:text-xl self-center text-2xl text-gray-900 whitespace-nowrap">Michael Toohig</span></a><div class="items-center flex md:hidden"><button class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label="Toggle between Dark and Light mode" type=button data-aw-toggle-color-scheme><svg class="h-6 w-6" data-icon=ph:sun height=1em width=1em><symbol id=ai:ph:sun viewBox="0 0 256 256"><path d="M120 40V16a8 8 0 0 1 16 0v24a8 8 0 0 1-16 0m72 88a64 64 0 1 1-64-64a64.07 64.07 0 0 1 64 64m-16 0a48 48 0 1 0-48 48a48.05 48.05 0 0 0 48-48M58.34 69.66a8 8 0 0 0 11.32-11.32l-16-16a8 8 0 0 0-11.32 11.32Zm0 116.68l-16 16a8 8 0 0 0 11.32 11.32l16-16a8 8 0 0 0-11.32-11.32M192 72a8 8 0 0 0 5.66-2.34l16-16a8 8 0 0 0-11.32-11.32l-16 16A8 8 0 0 0 192 72m5.66 114.34a8 8 0 0 0-11.32 11.32l16 16a8 8 0 0 0 11.32-11.32ZM48 128a8 8 0 0 0-8-8H16a8 8 0 0 0 0 16h24a8 8 0 0 0 8-8m80 80a8 8 0 0 0-8 8v24a8 8 0 0 0 16 0v-24a8 8 0 0 0-8-8m112-88h-24a8 8 0 0 0 0 16h24a8 8 0 0 0 0-16" fill=currentColor /></symbol><use href=#ai:ph:sun></use></svg></button> <button class="items-center transition dark:focus:ring-gray-700 dark:hover:bg-gray-800 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex ml-1.5 p-2.5 rounded-lg text-gray-500 text-sm" aria-label="Toggle Menu" type=button data-aw-toggle-menu><svg class="h-6 w-6" data-icon=ph:dots-three-vertical height=1em width=1em><symbol id=ai:ph:dots-three-vertical viewBox="0 0 256 256"><path d="M140 128a12 12 0 1 1-12-12a12 12 0 0 1 12 12m-12-56a12 12 0 1 0-12-12a12 12 0 0 0 12 12m0 112a12 12 0 1 0 12 12a12 12 0 0 0-12-12" fill=currentColor /></symbol><use href=#ai:ph:dots-three-vertical></use></svg></button></div></div><nav aria-label="Main navigation" class="items-center hidden md:flex dark:text-slate-200 h-[calc(100vh-72px)] md:h-auto md:mx-5 md:overflow-visible md:w-auto overflow-y-auto w-full"><ul class="flex flex-col md:flex-row md:pt-0 md:self-center md:text-base md:w-auto pt-8 text-xl w-full"><li class=""><a href=/about class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">About</a></li><li class=""><a href=/projects class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Projects</a></li><li class=""><a href=/blog class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Blog</a></li><li class=""><a href=/blurbs class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Blurbs</a></li><li class=""><a href=/links class="items-center flex dark:hover:text-white duration-150 ease-in-out font-medium hover:text-primary px-4 py-3 transition">Links</a></li></ul></nav><div class="items-center flex md:mb-0 md:self-center"><div class="items-center hidden md:flex"><button class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label="Toggle between Dark and Light mode" type=button data-aw-toggle-color-scheme><svg class="h-5 w-5" data-icon=ph:sun height=1em width=1em viewBox="0 0 256 256"><use href=#ai:ph:sun></use></svg></button></div></div></div></header><main><section class="mx-auto lg:py-20 py-8 sm:py-16"><article><header class=""><div class="flex px-4 flex-col justify-between max-w-3xl mb-2 mt-0 mx-auto sm:flex-row sm:items-center sm:px-6"><p><svg class="dark:text-gray-400 -mt-0.5 h-4 inline-block w-4" data-icon=ph:timer height=1em width=1em><symbol id=ai:ph:timer viewBox="0 0 256 256"><path d="M128 40a96 96 0 1 0 96 96a96.11 96.11 0 0 0-96-96m0 176a80 80 0 1 1 80-80a80.09 80.09 0 0 1-80 80m45.66-125.66a8 8 0 0 1 0 11.32l-40 40a8 8 0 0 1-11.32-11.32l40-40a8 8 0 0 1 11.32 0M96 16a8 8 0 0 1 8-8h48a8 8 0 0 1 0 16h-48a8 8 0 0 1-8-8" fill=currentColor /></symbol><use href=#ai:ph:timer></use></svg> <time datetime="Fri Aug 05 2022 20:00:00 GMT-0400 (Eastern Daylight Time)">Aug 6, 2022</time> · 12 min read</p></div><h1 class="mx-auto sm:px-6 max-w-3xl px-4 font-bold font-heading leading-tighter md:text-5xl text-4xl tracking-tighter">Integrating A New Subscriber Management System</h1><p class="mx-auto sm:px-6 max-w-3xl px-4 dark:text-slate-400 mb-8 md:text-2xl mt-4 text-justify text-muted text-xl"></p><img alt="Writing the glue to tie two different systems under one managment software.
" aspectRatio=1.7777777777777777 class="mx-auto bg-gray-400 dark:bg-slate-700 dark:lg:shadow-orange-200 lg:max-w-6xl lg:ring-2 lg:shadow-lg max-w-full mb-6 ring-none ring-opacity-50 ring-orange-500 sm:rounded-md" decoding=async height=506 loading=eager sizes="(max-width: 900px) 400px, 900px" src=/_astro/integrating-a-new-sms.C1b65GVB_ZqfuXO.webp srcset="/_astro/integrating-a-new-sms.C1b65GVB_ZqfuXO.webp 400w, /_astro/integrating-a-new-sms.C1b65GVB_ZqfuXO.webp 900w" width=900></header><div class="mx-auto sm:px-6 max-w-3xl px-6 mt-8 dark:prose-a:text-orange-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-orange-600 prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-lg prose-li:my-0 prose-md"><h3 id=background>Background</h3><p>$BUSINESS provides subscription digital TV services over the air called <abbr title="Digital Video Broadcasting">DVB</abbr> to households and larger systems for hotels and resorts in $TOWN. From the source at the top of the town’s hill the TV channels are received, transcoded, muxed, encrypted and broadcast. Each customer has a decoder to decrypt the signal which is either a simple box connected via HDMI to the TV or a more advanced <abbr title="Integrated Receiver Decoder">IRD</abbr> for commerical installations. At the heart of all this is the <abbr title="Conditional Access System">CAS</abbr> which encodes authorization messages in the broadcast signal and allows decoders to know which signals they can decrypt and for how long. You can read the <a href=https://patents.google.com/patent/KR20090073485A/en>patent</a> for further details.</p><h2 id=problem>Problem</h2><p>A new <abbr title="Conditional Access System">CAS</abbr> was purchased but it came from a new supplier and did not mesh with the existing systems. At the time two CAS were already in use, one for hotels and one for individual customer use, and both were from the same supplier. Adding a new CAS was not going to be straightforward as this new system had a fundementally different approach towards accepting authorization information and did not provide an API for anything less than a pricey amount.</p><p>The two existing CAS are tied together by an admin interface which most importantly ties invoicing to authorizations of the decoders. Finding a way to coerce the existing system into authorizing decoders on the new CAS would be the challenge.</p><p>Also, $BUSINESS ran out of the old model of decoder and already started selling the new decoder models. So for a couple weeks juggling the invoicing system and the new CAS subscriber management system was necessary until a complete migration to just the invoicing system was possible.</p><h3 id=technical-background-and-attack-strategies>Technical Background and Attack Strategies</h3><p>The existing CAS at $BUSINESS each have a database and some of the tables therein are periodically checked by the CAS itself for tasks to be performed such as updating authorizations, <abbr title="On Screen Display">OSD</abbr> messages or mail messages to the customer decoder.</p><p>Microsoft SQL Server is the RDBS for both the invoicing system and for the all of the CAS. On the invoicing database a SQL Server Agent ran a periodic task to run stored procedures which inserts the authorization information into the CAS database. Below is an example of one of those authorizations as received by the CAS.</p><blockquote><p>Note: decoders have a removable card inside them which behaves exactly the same as a SIM card for a phone. So I will continue use the word decoder but you may see <code>card</code> in some of the examples but just know that <code>card</code> is referencing a decoder. And on the new CAS you will see <code>STB</code> but that also just means a decoder.</p></blockquote><pre><code>| CardID     | ProductNumber | ProductStartTime        | ProductEndTime          | SendTime                |
|------------|---------------|-------------------------|-------------------------|-------------------------|
| 4291000278 | 1             | 2022-07-05 00:00:00.000 | 2022-07-31 23:59:59.000 | 2022-07-05 08:39:03.347 |
</code></pre><p>The best outcome would be to pass the same sort of instruction to the new CAS so that it would broadcast authorizations to decoders. A simple update to the SQL Server stored proceedure and we would be done.</p><h4 id=attacking-the-database>Attacking the Database</h4><p>The CAS had two databases one for the <abbr title="Entitlement Management Message Generator">EMMG</abbr> and the <abbr title="Entitlement Control Message Generator">EMCG</abbr> which work together to encode the authorizations into the broadcast signal and a second for the subscriber management system.</p><p>I first played around with the <abbr title="Subscriber Management System">SMS</abbr> to see how the database responded to particular actions. I was concerned when I saw some cryptic values in the tables that appeared when granting authorization to my test decoder.</p><pre><code>| Auth_Buffer                                                                                                                                        | AuthVersion | STBNumber            |
|----------------------------------------------------------------------------------------------------------------------------------------------------|-------------|----------------------|
| 0x040000000200E607051F000000E607081F000000010500E607051F000000E607081F000000010800E607051F000000E607081F000000010A00E607051F000000E607081F00000001 | 44          | -8974767510011026891 |
</code></pre><p>I couldn’t quite figure them out except I knew the <code>Auth_Buffer</code> was describing the products to decrypt. I did know this because it looked just like the authorization strings used in the existing CAS which could be generated with a helper tool provided by the other supplier and were statically set. But this CAS was hiding the generation of this string for each and every authorization change per decoder. I figured this was hidden somewhere in their backend when it was communicating with a supplied dongle that must be inserted for the software to work. And I do not know where these <code>STBNumber</code> values were coming from as they did not match any actual number of the decoders that I was aware of and changed with each authorization even for the same decoder. By messing around with the database and trying to force the system to accept known good values via a replay-attack and failing I knew this database was also not the source of truth for authorizations but instead was just a running log of authorization jobs that have already been performed.</p><p>I then tried the same attacks to the tables in the SMS database to mimick the rows that would be inserted for a given user action on the web interface but nothing would happen. So the key was in the backend code and probably tied to the “softdog” dongle inserted to the server that without it the software would not work. I think it is also a backdoor for the supplier to provide support because when I asked general questions to the supplier they would respond with specific responses they couldn’t have known without looking directly at the data I had modified. Kinda scary.</p><p>Direct manipulation of the database was ruled out and as much as I would enjoy learning to reverse engineer the software further it wasn’t the fastest way to a working solution when more options were still available.</p><h4 id=attacking-the-web-user-interface>Attacking the Web User Interface</h4><p>Now that direct modification of the database is ruled out, the next step would be to mimick a user on the web <abbr title="User Interface">UI</abbr>. Looking at the browser’s DevTools it was easy to record the URLs and form data required for each action I needed to perform. But before I could submit forms using <a href=https://requests.readthedocs.io/ >requests</a> the UI presented a challenge at the login screen.</p><p>Logging in with <code>admin</code> and the secure password <code>123456</code> in the form would submit the following to the backend.</p><figure data-rehype-pretty-code-figure=""><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=json data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=json data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>{</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  LoginID</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>admin</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>  LoginPassword</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> &quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>d3Sc32H1RQ0zJcAUc1mWCb/lEGJTHes8b+uykb3Xr+3djFmJAQsZBgEOLyz9Bwt7csBH2LjUr7XjoZnOCfJOUnfGB4U9TS5f+263ZQGwQcaqzvgmQhl6h/B+/krH4vBE+TMuAckEtpnT9c1Lk4iMuHS9qh2x46x5DRMpAoo4c9A=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>}</span></span></code></pre></figure><p>The login form was not submitting my creditionals from the login form in cleartext but was encrypting it.</p><p>To mimick a user logging in I had to port the encryption code from their site’s Javascript files and pull out an obfuscated public key to RSA encrypt the username, password and a timestamp to create the <code>LoginPassword</code> field the backend expected. Then I would be rewarded with authorization to access the SMS UI further and be allowed to submit other forms.</p><p>I then found performing a single POST request to mimick a user submiting a form would invalidate the current user credentials. Each form submitted would reload the page and I found new authentication tokens were snuck into the bottom of the returned HTML body. Using <a href=https://www.crummy.com/software/BeautifulSoup/ >Beautiful Soup</a> it was easy to grab the <code>&lt;object&gt;</code> tag at the end of the HTML file and grab updated <code>SessionID</code> and <code>AspxAuth</code> values to use in the next request headers.</p><p>The SMS didn’t stop complicating matters there, a single form could require up to 30 fields. Most of those fields were redundant since a <code>CustomerID</code> field would be required along with <code>CustomerName</code>, <code>CustomerRegion</code>, etc which all could be derived on the backend from the <code>CustomerID</code> so I have no idea why these forms were made this way. Also, every action performed on the web UI returned plain HTML so there was no raw JSON responses or anything easy to parse. I hooked into the SMS database with <a href=https://sqlalchemy.org>SQLAlchemy</a> to have direct access the values needed for each form.</p><p>Soon I had mapped out the actions I would need to perform on the web UI and the form data needed for each. This would include helper functions that would handle each step in the login -&gt; subscribe to product -&gt; make payment process.</p><figure data-rehype-pretty-code-figure=""><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> subscribe_product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> months</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> int</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> card_id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> int</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    &quot;&quot;&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>Creates an authorization for a card/STB for the given product.</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;&quot;&quot;</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    end </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> get_end_date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> months</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    subs </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Subscription</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>get_overlaps</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> card_id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    logger</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>debug</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>f</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>&quot;Found </span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>{</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>len</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>subs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>}</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440> overlapping subscriptions&quot;</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    for</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sub </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>in</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> subs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        if</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sub</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>is_active</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>():</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>            unsubscribe_product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>sub</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>card_id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sub</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        else</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>            sub</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>delete</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    # perform steps to create and pay for a product</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    dibsys </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Dibsys</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    dibsys</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>update_auth_headers</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    dibsys</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>make_product_order</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> months</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> card_id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> product</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    dibsys</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>update_auth_headers</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    dibsys</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>make_charge</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span></code></pre></figure><p>Although a bit cumbersome it was a working method to initiate an authorization to a decoder from a program.</p><h4 id=mitigating-defined-limitations>Mitigating Defined Limitations</h4><p>The last major issue I ran into was the web UI enforced the duration of subscriptions to be purchased in months. You can see in the last section the <code>subscribe_product</code> function takes a <code>start</code> date and a <code>months</code> integer for the number of months to subscribe. At first the solution is obvious, start subscriptions in the past so that the end date occurs when you want the subscription to end. But the logic hidden in the backend also enforced that no subscription may overlap a previous subscription. So when you set the start date 25 days in the past to give a 5 days trial to a customer then allow them to purchase the remainder of the month by setting a new start date 5 days in the past an error is thrown that the decoder already has a subscription in that timeframe.</p><p>So I had to dig into the SMS database to find what is enforcing this rule. I found in the SMS database the subscriptions table kept record of… subscriptions. It had an obtuse way of separating cancelled subscriptions from expired subscriptions but eventually it was decoded.</p><pre><code># simplified version
| CustomerID | DecoderID | ProductID | StartDate               | EndDate                 | OperateType | BackOrderID | Remark                                                   | AuthStatus |
| 1          | 134       | 5         | 2022-07-01 00:00:00.000 | 2022-07-15 00:00:00.000 | 2           | 128         | Unsubscribed IC Number [128] IC [13466-8373388000134669] | 0          |
</code></pre><p>I also realized the <code>DecoderID</code> had no constraint to reference an ID that actually exists in the decoder table. It appeared the backend was searching the subscription table for any subscription that matched the <code>DecoderID</code> and that naturally expired between the given dates. So I ended up <em>deleting</em> the subscriptions by changing the <code>DecoderID</code> value to <code>0</code> and the web UI no longer blocked me from creating overlapping subscriptions.</p><p>Lastly, to handle subscriptions of any duration I added some helper functions to select a start date based on an end date that would match the logic of the SMS backend. Sometimes this meant a subscription for one day would be two months long because I would have to go back two months for a month that had 31 days so the subsciption would end the following day on the 31st.</p><figure data-rehype-pretty-code-figure=""><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> get_months_between</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> -&gt;</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> int</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    &quot;&quot;&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>Return number of months between two dates. Good enough.</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;&quot;&quot;</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    return</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> (</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>year </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>-</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>year</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> *</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 12</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> +</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>month </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>-</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>month</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> get_start_date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> -&gt;</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    &quot;&quot;&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>Return a start date that ensures a subscription will end on given date.</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>    This is a trick I&#39;m using to get around the one month subscription</span></span>
<span data-line=""><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>    requirement by creating subscriptions with start dates in the past</span></span>
<span data-line=""><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>    to trick the subscription to end on the date given.</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    &quot;&quot;&quot;</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    months_with_31_days </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72> [</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>1</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 3</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 5</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 7</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 8</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 10</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 12</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>]</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    today </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> datetime</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>now</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>().</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    month </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> None</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    for</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> n</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> m </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>in</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> enumerate</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>months_with_31_days</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        if</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> m </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>&gt;=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>month </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>or</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> m </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>&gt;=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> today</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>month</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>            month </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> months_with_31_days</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>[</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>n </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>-</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> 1</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>]</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>            break</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    start </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> date</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>today</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>year</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> month</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>day</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    months_to_end </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> get_months_between</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> end</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> start</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> months_to_end</span></span></code></pre></figure><h4 id=handling-multiple-databases>Handling Multiple Databases</h4><p>Since I was working with both the new tasks database and the SMS database I created a SQLAlchemy session class that would route to the correct engine based on the ORM model’s parent class.</p><figure data-rehype-pretty-code-figure=""><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sqlalchemy </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> create_engine</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sqlalchemy</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>orm </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Session </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>as</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> SQLA_Session</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sessionmaker</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> dibsys_cli</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>config </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> TASK_DATABASE_URI</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> WEB_DATABASE_URI</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>task_engine </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> create_engine</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>TASK_DATABASE_URI</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>web_engine </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> create_engine</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>WEB_DATABASE_URI</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>class</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22> RoutingSession</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>SQLA_Session</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>    &quot;&quot;&quot;</span><span style=--shiki-dark:#B5BD68;--shiki-light:#8C9440>Decides which engine to use for database queries.</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>&quot;&quot;&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> get_bind</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> mapper</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>None</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> clause</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>None</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> dibsys_cli</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>database</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>models</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>base </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> WebBase</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        if</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> mapper </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>and</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> issubclass</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>mapper</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>class_</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> WebBase</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>            return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> web_engine</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        return</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> task_engine</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>Session </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sessionmaker</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    autocommit</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>False</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    autoflush</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F>False</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    class_</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>RoutingSession</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span></span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>)</span></span></code></pre></figure><p>This gave the advantage that I didn’t have to juggle which database I would connect to for the object I was dealing with. With an explicit base class I could also define basic operations that were allowed so it was difficult to modify a row in a table that I didn’t want modified.</p><figure data-rehype-pretty-code-figure=""><pre class="(Straight) (Straight) - - Remedy Remedy Bright Dark" data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=--shiki-dark:#F9E7C4;--shiki-light:#594318;--shiki-dark-bg:#403A35;--shiki-light-bg:#FFF9EC tabindex=0><code data-language=python data-theme="Remedy - Dark (Straight) Remedy - Bright (Straight)" style=display:grid><span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sqlalchemy </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> MetaData</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sqlalchemy</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>exc </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> SQLAlchemyError</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> sqlalchemy</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>ext</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>declarative </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> as_declarative</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>from</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> dibsys_cli</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>database</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>.</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>session </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>import</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Session</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>@</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>as_declarative</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>class</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22> Base</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span></span>
<span data-line=""><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D>    id</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> Any</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    __name__</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>:</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> str</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> save</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        raise</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> NotImplementedError</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> delete</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        raise</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> NotImplementedError</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> update</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> **</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>kwargs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>        raise</span><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666> NotImplementedError</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>class</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22> TaskBase</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22>Base</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    __abstract__ </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> True</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    metadata </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> MetaData</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> save</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>        ...</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> delete</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>        ...</span></span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>    def</span><span style=--shiki-dark:#81A2BE;--shiki-light:#5F819D> update</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>self</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>,</span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F> **</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>kwargs</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#CC6666;--shiki-light:#CC6666>        ...</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>class</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22> WebBase</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>(</span><span style=--shiki-dark:#F0C674;--shiki-light:#D79A22>Base</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>):</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    __abstract__ </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#DE935F;--shiki-light:#DE935F> True</span></span>
<span data-line=""><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318>    metadata </span><span style=--shiki-dark:#B294BB;--shiki-light:#85678F>=</span><span style=--shiki-dark:#F9E7C4;--shiki-light:#594318> MetaData</span><span style=--shiki-dark:#81755D;--shiki-light:#B19C72>()</span></span></code></pre></figure><h2 id=solution>Solution</h2><p>To continue use of the stable, legacy invoicing and subscriber management system I had to connect it to a new CAS target that looked like a CAS from its own supplier. First, I added a new database with tables that mirrored the tables found in the existing CAS that I called the “<em>tasks</em>” database. I updated the legacy invoice software so that changes to invoices that included a decoder from the new supplier would result in authorization messages arriving in the new tasks database. Then, a script I wrote would periodically view the entries to the tasks database and peform the necessary steps on the new SMS web UI to complete the authorization tasks. Essentially, making the new SMS believe someone was sitting at a desk going through the motions required to authorize a decoder.</p><p>I wrote this solution with Python and used <a href=https://click.palletsprojects.com/ >click</a> to make a <abbr title="Command Line Interface">CLI</abbr> for interfacing with the new CAS. This CLI could mimick a user on the web UI or browse and modify the tables of the SMS directly where possible. Adding the CLI command to <code>cron</code> runs the tasks periodically and keeps customers of the new decoders subscribed.</p></div><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mt-8 px-6"><ul class=mr-5><li class="inline-block bg-gray-100 dark:bg-slate-700 font-medium lowercase mb-2 mr-2 px-2 py-0.5">python</li><li class="inline-block bg-gray-100 dark:bg-slate-700 font-medium lowercase mb-2 mr-2 px-2 py-0.5">sql</li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="text-gray-400 align-super dark:text-slate-400 font-bold">Share:</span> <button class=ml-2 data-aw-social-share=twitter data-aw-url=https://michaeltoohig.com/projects/integrating-a-new-sms title="Twitter Share" data-aw-text="Integrating A New Subscriber Management System"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:twitter-fill height=1em width=1em><symbol id=ai:ri:twitter-fill viewBox="0 0 24 24"><path d="M22.213 5.656a8.4 8.4 0 0 1-2.402.658A4.2 4.2 0 0 0 21.649 4c-.82.488-1.719.83-2.655 1.015a4.182 4.182 0 0 0-7.126 3.814a11.87 11.87 0 0 1-8.621-4.37a4.17 4.17 0 0 0-.566 2.103c0 1.45.739 2.731 1.86 3.481a4.2 4.2 0 0 1-1.894-.523v.051a4.185 4.185 0 0 0 3.355 4.102a4.2 4.2 0 0 1-1.89.072A4.185 4.185 0 0 0 8.02 16.65a8.4 8.4 0 0 1-6.192 1.732a11.83 11.83 0 0 0 6.41 1.88c7.694 0 11.9-6.373 11.9-11.9q0-.271-.012-.541a8.5 8.5 0 0 0 2.086-2.164" fill=currentColor /></symbol><use href=#ai:ri:twitter-fill></use></svg></button> <button class=ml-2 data-aw-social-share=facebook data-aw-url=https://michaeltoohig.com/projects/integrating-a-new-sms title="Facebook Share"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:facebook-box-fill height=1em width=1em><symbol id=ai:ri:facebook-box-fill viewBox="0 0 24 24"><path d="M15.402 21v-6.966h2.333l.349-2.708h-2.682V9.599c0-.784.218-1.319 1.342-1.319h1.434V5.857a19 19 0 0 0-2.09-.107c-2.067 0-3.482 1.262-3.482 3.58v1.996h-2.338v2.708h2.338V21H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1z" fill=currentColor /></symbol><use href=#ai:ri:facebook-box-fill></use></svg></button> <button class=ml-2 data-aw-social-share=linkedin data-aw-url=https://michaeltoohig.com/projects/integrating-a-new-sms title="Linkedin Share" data-aw-text="Integrating A New Subscriber Management System"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:linkedin-box-fill height=1em width=1em><symbol id=ai:ri:linkedin-box-fill viewBox="0 0 24 24"><path d="M18.336 18.339h-2.665v-4.177c0-.996-.02-2.278-1.39-2.278c-1.389 0-1.601 1.084-1.601 2.205v4.25h-2.666V9.75h2.56v1.17h.035c.358-.674 1.228-1.387 2.528-1.387c2.7 0 3.2 1.778 3.2 4.092v4.714M7.004 8.575a1.546 1.546 0 0 1-1.548-1.549a1.548 1.548 0 1 1 1.547 1.549m1.336 9.764H5.667V9.75H8.34zM19.67 3H4.33C3.594 3 3 3.58 3 4.297v15.406C3 20.42 3.594 21 4.328 21h15.339C20.4 21 21 20.42 21 19.703V4.297C21 3.581 20.4 3 19.666 3z" fill=currentColor /></symbol><use href=#ai:ri:linkedin-box-fill></use></svg></button> <button class=ml-2 data-aw-social-share=whatsapp data-aw-url=https://michaeltoohig.com/projects/integrating-a-new-sms title="Whatsapp Share" data-aw-text="Integrating A New Subscriber Management System"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:whatsapp-fill height=1em width=1em><symbol id=ai:ri:whatsapp-fill viewBox="0 0 24 24"><path d="M12.001 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.95 9.95 0 0 1-5.03-1.355L2.005 22l1.352-4.968A9.95 9.95 0 0 1 2.001 12c0-5.523 4.477-10 10-10M8.593 7.3l-.2.008a1 1 0 0 0-.372.1a1.3 1.3 0 0 0-.294.228c-.12.113-.188.211-.261.306A2.73 2.73 0 0 0 6.9 9.62c.002.49.13.967.33 1.413c.409.902 1.082 1.857 1.97 2.742c.214.213.424.427.65.626a9.45 9.45 0 0 0 3.84 2.046l.568.087c.185.01.37-.004.556-.013a2 2 0 0 0 .833-.231a5 5 0 0 0 .383-.22q.001.002.125-.09c.135-.1.218-.171.33-.288q.126-.13.21-.302c.078-.163.156-.474.188-.733c.024-.198.017-.306.014-.373c-.004-.107-.093-.218-.19-.265l-.582-.261s-.87-.379-1.402-.621a.5.5 0 0 0-.176-.041a.48.48 0 0 0-.378.127c-.005-.002-.072.055-.795.931a.35.35 0 0 1-.368.13a1.4 1.4 0 0 1-.191-.066c-.124-.052-.167-.072-.252-.108a6 6 0 0 1-1.575-1.003c-.126-.11-.243-.23-.363-.346a6.3 6.3 0 0 1-1.02-1.268l-.059-.095a1 1 0 0 1-.102-.205c-.038-.147.061-.265.061-.265s.243-.266.356-.41c.11-.14.203-.276.263-.373c.118-.19.155-.385.093-.536q-.42-1.026-.868-2.041c-.059-.134-.234-.23-.393-.249q-.081-.01-.162-.016a3 3 0 0 0-.403.004z" fill=currentColor /></symbol><use href=#ai:ri:whatsapp-fill></use></svg></button> <button class=ml-2 data-aw-social-share=mail data-aw-url=https://michaeltoohig.com/projects/integrating-a-new-sms title="Email Share" data-aw-text="Integrating A New Subscriber Management System"><svg class="h-6 w-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon=ri:mail-fill height=1em width=1em><symbol id=ai:ri:mail-fill viewBox="0 0 24 24"><path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m9.06 8.683L5.648 6.238L4.353 7.762l7.72 6.555l7.581-6.56l-1.308-1.513z" fill=currentColor /></symbol><use href=#ai:ri:mail-fill></use></svg></button></div></div></article></section><div class="mx-auto sm:px-6 max-w-3xl px-6 md:pb-20 md:pt-4 pb-12 pt-8"><a href=/projects class="btn btn-ghost md:px-3 px-3"><svg class="h-5 w-5 -ml-1.5 mr-1" data-icon=ph:arrow-fat-left height=1em width=1em><symbol id=ai:ph:arrow-fat-left viewBox="0 0 256 256"><path d="M208 72h-80V32a8 8 0 0 0-13.66-5.66l-96 96a8 8 0 0 0 0 11.32l96 96A8 8 0 0 0 128 224v-40h80a16 16 0 0 0 16-16V88a16 16 0 0 0-16-16m0 96h-88a8 8 0 0 0-8 8v28.69L35.31 128L112 51.31V80a8 8 0 0 0 8 8h88Z" fill=currentColor /></symbol><use href=#ai:ph:arrow-fat-left></use></svg> Back to Projects</a></div></main><footer class="relative border-gray-200 border-t dark:border-slate-800"><div class="dark:bg-dark absolute inset-0 pointer-events-none" aria-hidden=true></div><div class="mx-auto sm:px-6 px-4 dark:text-slate-300 max-w-7xl relative"><div class="py-8 gap-4 gap-y-8 grid grid-cols-12 md:py-12 sm:gap-8"><div class="col-span-12 lg:col-span-4"><div class=mb-2><a href=/ class="font-bold inline-block text-xl">Michael Toohig</a></div></div></div><div class="md:flex md:justify-between md:items-center md:py-8 py-6"><ul class="flex md:mb-0 -ml-2 mb-4 md:ml-4 md:order-1"><li><a href=/rss.xml class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label=RSS><svg class="h-5 w-5" data-icon=ph:rss height=1em width=1em><symbol id=ai:ph:rss viewBox="0 0 256 256"><path d="M106.91 149.09A71.53 71.53 0 0 1 128 200a8 8 0 0 1-16 0a56 56 0 0 0-56-56a8 8 0 0 1 0-16a71.53 71.53 0 0 1 50.91 21.09M56 80a8 8 0 0 0 0 16a104 104 0 0 1 104 104a8 8 0 0 0 16 0A120 120 0 0 0 56 80m118.79 1.21A166.9 166.9 0 0 0 56 32a8 8 0 0 0 0 16a151 151 0 0 1 107.48 44.52A151 151 0 0 1 208 200a8 8 0 0 0 16 0a166.9 166.9 0 0 0-49.21-118.79M60 184a12 12 0 1 0 12 12a12 12 0 0 0-12-12" fill=currentColor /></symbol><use href=#ai:ph:rss></use></svg></a></li><li><a href=https://github.com/michaeltoohig class="items-center dark:focus:ring-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-sm dark:hover:bg-gray-700 text-muted" aria-label=Github><svg class="h-5 w-5" data-icon=ph:github-logo height=1em width=1em><symbol id=ai:ph:github-logo viewBox="0 0 256 256"><path d="M208.31 75.68A59.78 59.78 0 0 0 202.93 28a8 8 0 0 0-6.93-4a59.75 59.75 0 0 0-48 24h-24a59.75 59.75 0 0 0-48-24a8 8 0 0 0-6.93 4a59.78 59.78 0 0 0-5.38 47.68A58.14 58.14 0 0 0 56 104v8a56.06 56.06 0 0 0 48.44 55.47A39.8 39.8 0 0 0 96 192v8H72a24 24 0 0 1-24-24a40 40 0 0 0-40-40a8 8 0 0 0 0 16a24 24 0 0 1 24 24a40 40 0 0 0 40 40h24v16a8 8 0 0 0 16 0v-40a24 24 0 0 1 48 0v40a8 8 0 0 0 16 0v-40a39.8 39.8 0 0 0-8.44-24.53A56.06 56.06 0 0 0 216 112v-8a58.14 58.14 0 0 0-7.69-28.32M200 112a40 40 0 0 1-40 40h-48a40 40 0 0 1-40-40v-8a41.74 41.74 0 0 1 6.9-22.48a8 8 0 0 0 1.1-7.69a43.8 43.8 0 0 1 .79-33.58a43.88 43.88 0 0 1 32.32 20.06a8 8 0 0 0 6.71 3.69h32.35a8 8 0 0 0 6.74-3.69a43.87 43.87 0 0 1 32.32-20.06a43.8 43.8 0 0 1 .77 33.58a8.09 8.09 0 0 0 1 7.65a41.7 41.7 0 0 1 7 22.52Z" fill=currentColor /></symbol><use href=#ai:ph:github-logo></use></svg></a></li></ul><div class="mr-4 dark:text-slate-400 text-sm">Made in Vanuatu 🇻🇺 · All rights reserved.</div></div></div></footer><script>!function(){const e="system";function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function o(e,t,o){const n="string"==typeof e?document.querySelectorAll(e):e;n&&n.length&&n.forEach((e=>{e.addEventListener(t,(t=>o(t,e)),!1)}))}e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light"),window.onload=function(){let t=window.scrollY,n=!0;function a(){const e=document.getElementById("header");t>60&&!e.classList.contains("scroll")?document.getElementById("header").classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&document.getElementById("header").classList.remove("scroll"),n=!1}o("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.querySelector("#header nav")?.classList.toggle("hidden")})),o("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),o("[data-aw-social-share]","click",(function(e,t){const o=t.getAttribute("data-aw-social-share"),n=encodeURIComponent(t.getAttribute("data-aw-url")),a=encodeURIComponent(t.getAttribute("data-aw-text"));let c;switch(o){case"facebook":c=`https://www.facebook.com/sharer.php?u=${n}`;break;case"twitter":c=`https://twitter.com/intent/tweet?url=${n}&text=${a}`;break;case"linkedin":c=`https://www.linkedin.com/shareArticle?mini=true&url=${n}&title=${a}`;break;case"whatsapp":c=`https://wa.me/?text=${a}%20${n}`;break;case"mail":c=`mailto:?subject=%22${a}%22&body=${a}%20${n}`;break;default:return}const s=document.createElement("a");s.target="_blank",s.href=c,s.click()})),a(),o([document],"scroll",(function(){t=window.scrollY,n||(window.requestAnimationFrame((()=>{a()})),n=!0)}))},window.onpageshow=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.querySelector("#header nav")?.classList.add("hidden")}}()</script></body></html>